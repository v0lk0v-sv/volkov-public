# Timeline

## Quick Start

1. Installation

```
npm install @av/timeline
```

2. Usage

```tsx
import '@av/timeline/dist/style.css';
import { Timeline } from '@av/timeline';

export function MyTimeline() {
  const getRows = ({ count, offset }) => ({
    count: 2,
    offset: 0,
    totalCount: 2,
    data: [
      { id: 'foo', title: 'Foo' },
      { id: 'bar', title: 'Bar' },
    ],
  });

  const getEvents = (rowId: string, from: number, to: number) => [
    {
      id: `${rowId}-${from}`,
      start: from + 60 * 60 * 1000,
      end: to - 60 * 60 * 1000,
      color: '#FF0000A0',
      highlightColor: '#FF0000',
    },
  ];

  return <Timeline getRows={getRows} getEvents={getEvents} />;
}
```

## Run development playground

1. Clone repository

2. Login to npm

   ```
   make login
   ```

3. Install dependencies

   ```
   npm install
   ```

4. Start development playground

   ```
   npm run dev
   ```

## Load data

### `getRows` <sup>required</sup>

Loads timeline rows pages with pagination, has to return rows page or promise of rows page

```ts
type GetRows<TTimelineRow extends TimelineRow = TimelineRow> = (
  options: TimelinePaginationOptions,
) => Promise<TimelineRowsPage<TTimelineRow>> | TimelineRowsPage<TTimelineRow>;
```

Pagination options:

```ts
type TimelinePaginationOptions = {
  offset: number; // skip from start count
  count: number; // rows count
};
```

Rows page is:

```ts
type TimelineRowsPage<TTimelineRow extends TimelineRow = TimelineRow> = {
  count: number; // rows count
  offset: number; // skipped from start count
  totalCount: number; // total rows count
  data: TimelineRowGroup<TTimelineRow>[]; // array of rows or rows groups
};
```

Row is:

```ts
type TimelineRow = {
  id: string; // Row id
  title: string; // Will be displayed in sidebar
  noEvents?: boolean; // If true - events will not be loaded for this row
};
```

Rows can be joined into groups, in collapsed state all events of this group will be inside single row:

```ts
type TimelineRowGroup<TTimelineRow extends TimelineRow = TimelineRow> = TTimelineRow & {
  children?: TimelineRowGroup<TTimelineRow>[]; // Child rows or groups
  defaultExpanded?: boolean; // If true - group will be expanded by default
};
```

If group itself does not has events and we need to load events only for leaf rows - set `noEvents` flag to the group

### `getEvents` <sup>required</sup>

Loads events, has to return array of events or promise of array of events

```ts
type GetEvents<TTimelineEvent extends TimelineEvent = TimelineEvent> = (
  rowId: string,
  from: number, // load events from timestamp, milliseconds
  to: number, // load events to timestamp, milliseconds
) => Promise<TTimelineEvent[]> | TTimelineEvent[];
```

This function will be called to load events of visible rows in visible time range. If event crosses multiple time ranges - it should be returned in all ranges in which event is located

Event is:

```ts
type TimelineEvent = {
  id: string;
  start: number; // Event start timestamp, milliseconds
  end: number; // Event end timestamp, milliseconds
  color: string; // Color of event line
  highlightColor?: string; // This color will be used to render event on hover
};
```

### `eventsLoadStepSize` <sup>optional</sup>

`number`, milliseconds default is 86400000 (24 hours)

Events are loading by time ranges, default is 24 hours range. It can be changed via this parameter

## Colors

### `colorScheme` <sup>optional</sup>

`string`, default: `"light"`

If `"dark"` - will be used dark scheme, otherwise - light scheme

Colors of events can be set via `color` field of event

Colors can be changed via css variables on className specified to Timeline component:

```
--timeline--background-color
--timeline--background-secondary-color
--timeline--text-color-primary
--timeline--text-color-secondary
--timeline--text-color-secondary-hover
--timeline--text-color-tertiary
--timeline--text-color-tertiary-hover
--timeline--text-color-quaternary
--timeline--text-color-quaternary-hover
--timeline--text-color-quinary
--timeline--text-color-quinary-hover
--timeline--button-subtle-color
--timeline--button-subtle-color-hover
--timeline--border-secondary-color
--timeline--border-tertiary-color
--timeline--current-time-color
--timeline--mouse-time-color
--timeline--mouse-time-line-color
--timeline--event-active-stroke-color
--timeline--event-hover-stroke-color
```

## Time view state

### `defaultViewRange` <sup>optional</sup>

`[number, number]`, default is current time with 4 hours grid size

Start and end timestamps of timeline view range.

### `onChangeViewRange` <sup>optional</sup>

`(range: [number, number]) => void`

Will be called when user scrolls or zooms with 500 ms debounce

### `viewRangeLimit` <sup>optional</sup>

`[number | null, number | null]`, default: `[null, null]` (unlimited scroll to both sides)

Start and end timestamps of view range limit. Timeline will not be scrollable outside of this limit.

## Timezone

### `viewTimeZone` <sup>optional</sup>

`string`, default is users timezone

Which timezone should be used to display date and time.

Timezones from `Intl.supportedValuesOf('timeZone')` can be used.

Why timezone name but not timezone offset? Because offset of timezone can change due to summer/winter time shift.

### `showTimezoneInfo` <sup>optional</sup>

`boolean`, default: `true`

If `viewTimeZone` is different from users timezone - show view timezone info in header.

## Render events

### `highlightHoveredEvent` <sup>optional</sup>

`boolean`, default: `true`

Hovered event will be highlighted using `highlightColor` of event

### `showHoveredEventPopup` <sup>optional</sup>

`boolean`, default: `true`

Show popup with event data next to hovered event

### `renderEventPopupContent` <sup>optional</sup>

`(event: TTimelineEvent) => ReactNode`

Function to render hovered event popup content

### `renderActiveEvent` <sup>optional</sup>

`(event: TTimelineEvent) => ReactNode`

Function to render clicked event in right side panel. If not provided - nothing happens on event click

### `activeEventPanelWidth` <sup>optional</sup>

`number | 'auto'`, default: `"auto"`

Width of clicked event side panel, if `"auto"` - width will be 30%, but min width is 320px

### `renderEventContent` <sup>optional</sup>

`(event: TTimelineEvent) => ReactNode`

Function to render something inside event line, performance sensitive, in case of many events timeline may work slow

### `eventContentMinWidth` <sup>optional</sup>

`number`, pixels, default: `10px`

Minimum width of event line when `renderEventContent` will be called for this event. Bigger this value, less events will be rendered, better performance

### `eventLineHeight` <sup>optional</sup>

`number`, pixels, default: `8px`

Height of event line

### `eventLineMargin` <sup>optional</sup>

`number`, pixels, default: `3px`

Vertical space between event lines of one row in case of crossed events

### `eventBorderRadius` <sup>optional</sup>

`number`, pixels, default: `0`

Border radius of event line. Performance sensitive, timeline may work slower in big amount of events

### `crossEventsStrategy` <sup>optional</sup>

`'overlay-crossed-events' | 'split-crossed-events'`, default: `"split-crossed-events"`

How to render crossed events, in one line to overlay each other or splitted into different lines

### `canChangeCrossEventsStrategy` <sup>optional</sup>

`boolean`, default: `false`

Show toggle cross events strategy button on each row in sidebar

## Sidebar

### `showSidebar` <sup>optional</sup>

`boolean`, default: `true`

If false - sidebar will not be rendered

### `sidebarWidth` <sup>optional</sup>

`number | "auto"`, default: `"auto"`

Width of sidebar in pixels, if `"auto"` - width will be 20%, but min width is 280px

### `renderSidebarRowContent` <sup>optional</sup>

`(options: SidebarRowOptions<TTimelineRow>) => ReactNode`

Function to render custom sidebar row content, options:

```ts
type SidebarRowOptions<TTimelineRow extends TimelineRow = TimelineRow> = {
  row: TTimelineRow;
  crossEventsStrategy: CrossEventsStrategy;
  settings: Settings;
  nestedLevel: number;
  hasChildren: boolean;
  expanded: boolean;
  onChangeCrossEventsStrategy?: ((crossEventsStrategy: CrossEventsStrategy) => void) | null;
};
```

## Header

### `headerHeight` <sup>optional</sup>

`number`, pixels, default: `44px`

Height of header

### `showScaleController` <sup>optional</sup>

`boolean`, default: `true`

Shows current grid size and "+" and "-" buttons in top right corner

## Rows

### `dataViewPadding` <sup>optional</sup>

`number`, pixels, default: `8px`

Space on top of first row and bottom of last row

### `rowPadding` <sup>optional</sup>

`number`, pixels, default: `10px`

Space on top and bottom of each row

### `highlightHoveredRow` <sup>optional</sup>

`boolean`, default: `false`

If true - hovered row will be highlighted

## Other

### `showCurrentTime` <sup>optional</sup>

`boolean`, default: `true`

Show red line on curren time position

### `showMouseTime` <sup>optional</sup>

`boolean`, default: `true`

Show time on mouse position

### `renderGridLines` <sup>optional</sup>

`boolean`, default: `true`

Show vertical lines of time grid

### `className` <sup>optional</sup>

`string`

className of timeline root node
